import os
import yaml


def _require_env(name: str) -> str:
    value = os.getenv(name)
    if not value:
        raise RuntimeError(f"Missing required environment variable: {name}")
    return value


def load_configs(config_file="config.yaml"):
    """
    Loads non-secret config from YAML
    Loads secrets from environment variables
    """

    # ---------- Load non-secret config ----------
    with open(config_file) as f:
        config = yaml.safe_load(f)

    # ---------- Load secrets from ENV ----------
    secrets = {
        "bitbucket": {
            "username": _require_env("BITBUCKET_USERNAME"),
            "email": _require_env("BITBUCKET_EMAIL"),
            "access_token": _require_env("BITBUCKET_ACCESS_TOKEN"),
        },
        "github": {
            "username": _require_env("GITHUB_USERNAME"),
            "email": _require_env("GITHUB_EMAIL"),
            "access_token": _require_env("GITHUB_ACCESS_TOKEN"),
        },
    }

    return config, secrets
